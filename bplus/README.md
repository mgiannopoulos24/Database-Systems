# Εργασία Συστημάτων Βάσεων Δεδομένων - Β+ Δέντρα

## Υλοποιημένα Τμήματα
### Συναρτήσεις Αρχείων Β+ Δέντρου (BP)

Στην εργασία αυτή, υλοποιήθηκε μια απλή δομή Β+ δέντρου, με σκοπό την αποθήκευση και ανάκτηση εγγραφών από ένα αρχείο. Οι κύριες λειτουργίες που υλοποιήθηκαν είναι:

- **BP_CreateFile:** Δημιουργεί ένα νέο, κενό αρχείο Β+ δέντρου και αποθηκεύει τα απαραίτητα μεταδεδομένα.
- **BP_OpenFile:** Ανοίγει ένα υπάρχον αρχείο Β+ δέντρου και ανακτά τα μεταδεδομένα του.
- **BP_CloseFile:** Κλείνει το ανοιχτό αρχείο Β+ δέντρου και απελευθερώνει τυχόν δεσμευμένη μνήμη.
- **BP_InsertEntry:** Εισάγει μια νέα εγγραφή στο Β+ δέντρο, διατηρώντας την ισορροπία του δέντρου.
- **BP_GetEntry:** Αναζητά μια εγγραφή στο Β+ δέντρο βάσει του κλειδιού της (id).

## Δομές και Συναρτήσεις Κόμβων Δεδομένων (BP Data Nodes)

- **BPLUS_DATA_NODE:** Δομή που αντιπροσωπεύει έναν κόμβο δεδομένων του Β+ δέντρου.
  - **fields:** Περιλαμβάνει τα κλειδιά, τα παιδιά, τον αριθμό των κλειδιών, αν είναι φύλλο, και δείκτη στο επόμενο φύλλο.
  - **MAX_KEYS:** Ο μέγιστος αριθμός κλειδιών ανά κόμβο ορίζεται σε 4.
- **Συναρτήσεις:**
  - **create_node:** Δημιουργεί έναν νέο κόμβο, ορίζοντας αν είναι φύλλο ή όχι.
  - **insert:** Εισάγει μια εγγραφή στο δέντρο.
  - **search:** Αναζητά μια εγγραφή με συγκεκριμένο κλειδί.
  - **display:** Προβάλλει όλες τις εγγραφές του δέντρου.
  - **destroy:** Καταστρέφει όλους τους κόμβους του δέντρου και απελευθερώνει τη μνήμη.
 - **insert_unfull:** Εισαγωγή εγγραφής σε μη γεμάτο κόμβο.
 - **split_child:** Διαχωρισμός κόμβου όταν γεμίσει.
 - **allocate_node:** Συνάρτηση που επιστρέφει έναν νέο κόμβο από τη δεξαμενή.

## Πώς να Χρησιμοποιήσετε τα Εκτελέσιμα

1. **Μεταγλώττιση:** Εκτελέστε την εντολή:
```console
make
```

Αυτό θα δημιουργήσει το εκτελέσιμο αρχείο `bplus_main` στον φάκελο `build/`.

2. **Εκτέλεση:** Εκτελέστε το πρόγραμμα με την εντολή:

```console
./build/bplus_main
```

3. Διαγραφή Αρχείου Δεδομένων: Το αρχείο δεδομένων `data.db` διαγράφεται και δημιουργείται εκ νέου κάθε φορά που εκτελείται η εντολή `make` ή μαζί με το εκτελέσιμο αν εκτελεστεί η εντολή `make clean`.

## Συντελεστές
- **Δημήτρης Σκόνδρας-Μέξης, AM 1115202200161**
- **Ελένη Μεταλλίδου, AM 1115202200272**
- **Μάριος Γιαννόπουλος, AM 1115202000032**

Οι οποίοι συνέβαλαν εξίσου σε κάθε κομμάτι της άσκησης.

## Σκοπός της Εργασίας
Η εργασία αυτή είχε ως στόχο την κατανόηση και υλοποίηση των δομών δεδομένων που χρησιμοποιούνται στα συστήματα βάσεων δεδομένων, και συγκεκριμένα των Β+ δέντρων. Μέσω της υλοποίησης, αποκτήθηκε εμπειρία στην:

- Διαχείριση εγγραφών με αποδοτικό τρόπο.
- Υλοποίηση πολύπλοκων δομών δεδομένων.
- Διατήρηση της ισορροπίας του δέντρου μετά από εισαγωγές και διαγραφές.


## Ενδεικτική Εκτέλεση
```console
$ make && ./build/bplus_main
Compiling bplus_main ...
rm -f ./build/bplus_main data.db
gcc -g -I ./include -L./lib -Wl,-rpath=./lib ./examples/bp_main.c ./src/record.c ./src/bp_file.c ./src/bp_datanode.c ./src/bp_indexnode.c -lbf -o ./build/bplus_main -O2
Duplicate id detected: 336
Duplicate id detected: 379
Duplicate id detected: 784
Duplicate id detected: 528
Duplicate id detected: 500
Duplicate id detected: 292
Duplicate id detected: 100
Duplicate id detected: 231
Duplicate id detected: 338
Duplicate id detected: 857
Duplicate id detected: 127
Duplicate id detected: 179
Duplicate id detected: 211
Duplicate id detected: 379
Duplicate id detected: 573
Duplicate id detected: 159
Searching for: 159
(159,Sofia,Mavromatis,Ioannina)
Searching for: 161
(161,Dimitrios,Skondras,Piraeus)
Searching for: 1000
Cannot find an entry for id = 1000
```

Σημείωση: Τα μηνύματα για τα διπλότυπα κλειδιά εκτυπώνονται στο `stderr`.

## Σχετικά με τα αρχεία:
- Δεν έχουν προστεθεί άλλα αρχεία.
- Τα αρχεία που έχουν τροποποιηθεί είναι τα **bf_main.c, bp_file.h, bp_datanode.h, bp_datanode.c & bp_file.c**. Όλα τα άλλα μπορούν να αγνοηθούν.

## Επεξηγήσεις Κώδικα
- Στο **bp_file.h** ουσιαστικά ορίζεται το struct για την πληροφορία του Β+ Δέντρου. Πρόκειται για τον κόμβο ρίζας αλλά και 
τον αριθμό block που βρίσκεται.
- Στο **bp_datanode.h** ορίζεται το struct που περιέχει την πληροφορία του κάθε κόμβου ενός Β+ Δέντρου και τις λειτουργίες του. 
  - Για τις πληροφορίες κάθε κόμβου έχουμε ότι:
    - Θεωρούμε ότι ο κάθε κόμβος έχει **MAX_KEYS κλειδιά** (ίσο με 4 όπως ορίζεται μέσω define) και **MAX_KEYS + 1** παιδιά. 
    - Κρατάμε την πληροφορία για το εάν είναι φύλλο ή όχι, όπως επίσης και ένα κόμβο στο επόμενο φύλλο. 
    - Επειδή δεν είναι δεδομένο ότι θα έχουμε σε κάθε κόμβο ακριβώς MAX_KEYS κλειδιά, ορίζουμε και την μεταβλητή **n** που μας δείχνει πόσα κλειδία έχουμε αυτήν την στιγμή.
    - Θεωρούμε ότι το δέντρο έχει μέχρι **MAX_NODES** παιδιά (ίσο με 32768 όπως ορίζεται μέσω define). Ο λόγος είναι για να αποφύγουμε την χρήση της malloc. Αν παρατηρήσουμε ότι το πλήθος των δεδομένων είναι μεγαλύτερο από MAX_NODES, μπορούμε απλά να το αυξήσουμε.
  - Για τις λειτουργίες του Β+ Δέντρου έχουμε ότι:
    - Περιέχει τις βασικές λειτουργίες όπως create, insert, search, delete & display.
- Στο **bp_datanode.c** υλοποιείται η διεπαφή του bp_datanode.h, μια σημείωση είναι ότι υπάρχουν βοηθητικές συναρτήσεις οι οποίες ορίζονται ως **static** και βοηθάνε αρκετά στην απλότητα του κώδικα.
- Στο **bp_file.c** υλοποιούμε την διεπαφή που αναφέρει η άσκηση. Χρησιμοποιεί την διεπαφή του **bp_datanode.h** και την **bf.h**.
